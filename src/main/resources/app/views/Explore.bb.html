<%@ layout Layout %>
<%@ import app.model.* %>

<%@ params(Application selectedApp, Version selectedVersion, Release release, Resource selectedResource, String path, String filter) %>

<%-- TODO: Move Breadcrumb logic into base class --%>
<ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/${selectedApp.getFileSystemName()}">${selectedApp.getName()}</a></li>
    <li><a href="/${selectedApp.getFileSystemName() + "/" + selectedVersion.getName()}">${selectedVersion.getName()}</a></li>
    <li><a href="/${selectedApp.getFileSystemName() + "/" + selectedVersion.getName() + "/" + release.getName() + "/"}">${release.getName()}</a></li>
    <% if (path.length() > 0) {
        String[] pathArray = path.split("/");
        int i = 0;
        boolean zipped = false;
        String pathBuilder = "";
        while(i < pathArray.length) {
            String currentResource = pathArray[i];
            if (zipped) {
                i += 1;
                while (i < pathArray.length && !(currentResource.endsWith(".zip") || currentResource.endsWith(".jar"))) {
                    currentResource = currentResource + "/" + pathArray[i++];
                }
                i -= 1;
            }
            if (currentResource.endsWith(".zip") || currentResource.endsWith(".jar")) {
                zipped = true;
            }
            pathBuilder = pathBuilder + currentResource + "/";
            i += 1; %>
            <li><a href="/${selectedApp.getFileSystemName() + "/" + selectedVersion.getName() + "/" + release.getName() + "/" + pathBuilder}">${currentResource}</a></li>
        <%  }
    } %>
</ol>
<hr/>

<h2>Explore Release<i id="explore-ind" class="fa fa-spinner " style="display: none;"></i></h2>


<div class="row">
    <div class="col-md-6">
        <label for="version">Gosu Version Info</label>
        <input type="text" class="form-control mb-2 mr-sm-2 mb-sm-0" name="version" id="version" placeholder="Enter Gosu Versions">
        <button type="submit" class="btn btn-primary" >Save</button>
    </div>
</div>

<hr/>

<div class="row">
    <div class="col-md-12">
        <h3>
            Search Resources
            <span id="indicator" style="display:none"> <i class="fa fa-spinner fa-spin"></i> Searching... </span>
        </h3>

        <input class="form-control" type="text" name="filter" placeholder="Search Resources"
               value="${filter}"
               ic-get-from='/${selectedApp.getFileSystemName() + "/" + selectedVersion.getName() + "/" + release.getName() + "/" + path + "/" }'
               ic-trigger-on="keyup changed" ic-trigger-delay="500ms"
               ic-target="#resource-list" ic-indicator="#indicator">
    </div>
</div>

<hr/>

<div id="resource-list">
    <%@ section ResourceList(selectedApp, selectedVersion, release, selectedResource, path, filter) %>
    <% if (selectedResource.isDirectory()) { %>
    <div class="list-group" id="explorer">
        <% for (Resource r: selectedResource.getResources(filter)) { %>
        <a href="/${selectedApp.getFileSystemName() + "/" + selectedVersion.getName() + "/" + release.getName() + "/" + path + "/" + r.getName() + "/"}"
        class="list-group-item"
        onClick="document.getElementById("explore-ind").classList.remove("invisible-icon")>
        ${r.getName()}
        <% if (r.isDirectory()) { %>
        <i class="fa fa-folder-open" aria-hidden="true"></i>
        <% } %>
        </a>
        <% } %>
    </div>
    <% } else { %>
    ${selectedResource.getContent()}
    <% } %>
   <%@ end section %>
</div>
